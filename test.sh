#!/bin/bash -e

# --- For all variants

#-------------------------------------------------------------------
# Builds all the flavors of docker image to execute run time
# dgoss tests on the image
#-------------------------------------------------------------------

#To validate 4096 char works correctly
i=0
for x in Dockerfile*;do
  echo -e "\n\n======================="
  echo "testing $x"
  echo "======================="
  docker build -t runtimetestimage -f "${x}" .
  #passes an env variable of size more than 4K chars
  time dgoss run -e TEST_LONG_VAR=largevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargeva_extralargevar runtimetestimage || ((i++))
done

exit $i