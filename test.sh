#!/bin/bash -e

# --- For all variants

#-------------------------------------------------------------------
# Builds all the flavors of docker image to execute run time
# dgoss tests on the image
#-------------------------------------------------------------------

#To validate 4096 char works correctly

largevar="largevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargevarlargeva_extralargevar"

i=0
for x in Dockerfile*;do
  echo -e "\n\n======================="
  echo "testing $x"
  echo "======================="
  docker build -t runtimetestimage -f "${x}" .
  #passes an env variable of size more than 4K chars
  time dgoss run -v `pwd`/test_scripts:/test_scripts -e TEST_LONG_VAR="${largevar}" -e 1VAR_NAME=varnameStartWithNumber -e var.name=varnameHasPeriod -e var-name=varnameHasHyphen -e _=varnameHasJustUnderscore runtimetestimage || ((i++))
done

exit $i
