#!/bin/bash

# Script to detect processor architecture and output one of the two input parameters
# Example: when a download path requires an arch-specific package name
#
# --x64 {value}: output if an x86_64 architecture is detected
# --arm64 {value}: output if an arm64 or aarch64 architecture is detected

if [[ $1 == *"--"* ]]; then
  v="${1/--/}"
  declare $v="$2"
fi

if [[ $3 == *"--"* ]]; then
  v="${3/--/}"
  declare $v="$4"
fi

if [ -z "$x64" ]; then
  echo "error: missing --x64 input"
  exit 1
fi

if [ -z "$arm64" ]; then
  echo "error: missing --arm64 input"
  exit 1
fi

DETECTED_ARCH="$(uname -m)"
ARCH_X64='x86_64'
ARCH_ARM64='aarch64'
ARCH_ARM64_ALT='arm64';

if [[ $DETECTED_ARCH == $ARCH_X64 ]]; then
  echo $x64
elif [[ $DETECTED_ARCH == $ARCH_ARM64 ]]; then
  echo $arm64
elif [[ $DETECTED_ARCH == $ARCH_ARM64_ALT ]]; then
  echo $arm64
else
  echo 'failure: no supported processor architecture detected'
  exit 1
fi;